<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CALCULADORA PEDIÁTRICA SUS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #e5e7eb;
      --card: #ffffff;
      --primary: #1d4ed8;
      --primary-soft: #e5edff;
      --text: #111827;
      --text-muted: #4b5563;
      --border: #e5e7eb;
      --radius-xl: 22px;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.10);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #dbeafe 0, #e5e7eb 42%, #e5e7eb 100%);
      color: var(--text);
      text-transform: uppercase;
    }
    .header {
      padding: 20px 16px 4px;
    }
    .header-inner {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .header-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .header h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.18em;
    }
    .header-tag {
      font-size: 0.7rem;
      padding: 4px 12px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(15, 23, 42, 0.12);
      white-space: nowrap;
    }
    .header-sub {
      margin: 0;
      margin-top: 2px;
      color: var(--text-muted);
      font-size: 0.76rem;
      letter-spacing: 0.14em;
    }
    .main {
      max-width: 960px;
      margin: 0 auto 26px;
      padding: 0 16px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1fr);
      gap: 16px;
      align-items: stretch;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 20px 18px 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .card h2, .card h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 0.95rem;
      letter-spacing: 0.13em;
    }
    .card-subtitle {
      margin-top: -2px;
      margin-bottom: 12px;
      font-size: 0.7rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 14px;
      margin-bottom: 10px;
    }
    .form-group { display: flex; flex-direction: column; gap: 4px; }
    .form-group.full { grid-column: 1 / -1; }
    .form-group label { font-size: 0.76rem; color: var(--text-muted); }
    .inline-group { display: flex; gap: 8px; }
    input, select {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      padding: 8px 10px;
      font-size: 0.9rem;
      background: #ffffff;
      text-transform: none;
    }
    input::placeholder { text-transform: uppercase; font-size: 0.75rem; color: #9ca3af; }
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.38);
    }
    .btn-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 6px;
    }
    .btn-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #ffffff;
      padding: 9px 22px;
      font-size: 0.86rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }
    .btn-primary:hover { filter: brightness(1.03); }
    .btn-primary:active { transform: translateY(1px); }
    #result-card {
      gap: 10px;
    }
    .result-content { font-size: 0.9rem; color: var(--text); }
    .result-header {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      background: var(--primary-soft);
      border: 1px solid #c7d2fe;
    }
    .result-chip {
      font-size: 0.72rem;
      color: #1e3a8a;
    }
    .result-section { margin-bottom: 6px; }
    .result-section h4 {
      margin: 6px 0 3px;
      font-size: 0.78rem;
      letter-spacing: 0.1em;
    }
    .result-section p { margin: 0; }
    .badge {
      display: inline-block;
      padding: 1px 7px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
    }
    .badge-info { background: #dbeafe; color: #1d4ed8; }
    .badge-warning { background: #fef3c7; color: #92400e; }
    ul {
      margin: 6px 0 0 18px;
      padding: 0;
      font-size: 0.74rem;
      color: var(--text-muted);
    }
    .footer {
      text-align: center;
      padding: 4px 16px 18px;
      font-size: 0.74rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
    }
    @media (max-width: 880px) {
      .layout { grid-template-columns: 1fr; }
      #result-card { order: 2; }
    }
    @media (max-width: 640px) {
      .card { padding: 16px 14px 14px; border-radius: 18px; }
      .header h1 { font-size: 1.2rem; }
      .header-title-row { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="header-title-row">
        <h1>CALCULADORA PEDIÁTRICA SUS</h1>
        <span class="header-tag">USO PROFISSIONAL • UBS / UPA / HOSPITAL</span>
      </div>
      <p class="header-sub">PESO • IDADE • POSOLOGIA AUTOMÁTICA PARA MEDICAMENTOS PADRÃO SUS.</p>
    </div>
  </header>

  <main class="main">
    <div class="layout">
      <section class="card">
        <h2>DADOS DA CRIANÇA</h2>
        <p class="card-subtitle">PREENCHA O PESO, A IDADE E ESCOLHA O MEDICAMENTO.</p>
        <div class="form-grid">
          <div class="form-group">
            <label for="weight">PESO (KG)</label>
            <input type="number" id="weight" min="1" step="0.1" placeholder="EX.: 12,5" />
          </div>
          <div class="form-group">
            <label for="ageValue">IDADE</label>
            <div class="inline-group">
              <input type="number" id="ageValue" min="0" step="1" placeholder="EX.: 18" />
              <select id="ageUnit">
                <option value="months">MESES</option>
                <option value="years">ANOS</option>
              </select>
            </div>
          </div>
          <div class="form-group full">
            <label for="medication">MEDICAMENTO (SUS)</label>
            <select id="medication"></select>
          </div>
          <div class="form-group full" id="regimen-group" style="display:none;">
            <label for="regimen">ESQUEMA POSOLÓGICO</label>
            <select id="regimen"></select>
          </div>
        </div>
        <div class="btn-row">
          <button id="calculateBtn" class="btn-primary">CALCULAR POSOLOGIA</button>
        </div>
      </section>

      <section class="card" id="result-card">
        <div>
          <h2>RESULTADO</h2>
          <p class="card-subtitle">DOSES AUTOMÁTICAS COM CHECAGEM DE LIMITES.</p>
        </div>
        <div id="result-content" class="result-content">
          <p>PREENCHA OS CAMPOS AO LADO E CLIQUE EM CALCULAR POSOLOGIA.</p>
        </div>
      </section>
    </div>

    <section class="card">
      <h3>AVISOS RÁPIDOS</h3>
      <ul>
        <li>FERRAMENTA DE APOIO. NÃO SUBSTITUI RACIOCÍNIO CLÍNICO.</li>
        <li>CONFIRA SEMPRE DOSES MÁXIMAS, APRESENTAÇÕES E INDICAÇÕES.</li>
        <li>AJUSTE ESQUEMAS CONFORME PROTOCOLOS LOCAIS E CONDIÇÕES DO PACIENTE.</li>
      </ul>
    </section>
  </main>

  <footer class="footer">
    <p>CALCULADORA PARA USO MÉDICO – CONFIRA SEMPRE ANTES DE PRESCREVER.</p>
  </footer>

  <script>
    const MEDS_CONFIG = {
      AMOX_50: {
        id: "AMOX_50",
        name: "AMOXICILINA 50 MG/ML",
        category: "ANTIBIÓTICOS",
        calculator: "STANDARD",
        regimens: [
          {
            id: "AMOX_50_STD",
            label: "DOSE PADRÃO 50 MG/KG/DIA – 8/8 H POR 7 DIAS | MÁX 10 ML/DOSE",
            mgPerKgPerDay: 50,
            dosesPerDay: 3,
            concMgPerMl: 50,
            maxMlPerDose: 10
          },
          {
            id: "AMOX_50_HIGH",
            label: "DOSE ALTA 90 MG/KG/DIA – 8/8 H POR 7 DIAS | MÁX 10 ML/DOSE",
            mgPerKgPerDay: 90,
            dosesPerDay: 3,
            concMgPerMl: 50,
            maxMlPerDose: 10
          }
        ],
        notes: "DOSE PADRÃO 50 MG/KG/DIA OU DOSE ALTA 90 MG/KG/DIA, EM 3 TOMADAS POR 7 DIAS. DOSE MÁXIMA 10 ML/DOSE."
      },

      AMOXCLAV_50_12_5: {
        id: "AMOXCLAV_50_12_5",
        name: "AMOXICILINA + CLAVULANATO 50 MG + 12,5 MG/ML",
        category: "ANTIBIÓTICOS",
        calculator: "AMOXCLAV",
        regimens: [
          {
            id: "AMOXCLAV_STD",
            label: "DOSE PADRÃO 50 MG/KG/DIA (AMOXICILINA) – 8/8 H | MÁX 3 G/DIA AMOX + 375 MG/DIA CLAV",
            mgPerKgPerDay: 50,
            dosesPerDay: 3,
            concMgPerMl: 50,
            clavPerMl: 12.5,
            maxTotalAmoxMgPerDay: 3000,
            maxTotalClavMgPerDay: 375
          },
          {
            id: "AMOXCLAV_HIGH",
            label: "DOSE ALTA 90 MG/KG/DIA (AMOXICILINA) – 8/8 H | MÁX 3 G/DIA AMOX + 375 MG/DIA CLAV",
            mgPerKgPerDay: 90,
            dosesPerDay: 3,
            concMgPerMl: 50,
            clavPerMl: 12.5,
            maxTotalAmoxMgPerDay: 3000,
            maxTotalClavMgPerDay: 375
          }
        ],
        notes: "RESPEITAR LIMITE DE 3 G/DIA DE AMOXICILINA E 375 MG/DIA DE CLAVULANATO."
      },

      AZITRO_200_5: {
        id: "AZITRO_200_5",
        name: "AZITROMICINA 200 MG/5 ML (40 MG/ML)",
        category: "ANTIBIÓTICOS",
        calculator: "STANDARD",
        regimens: [
          {
            id: "AZITRO_10",
            label: "10 MG/KG/DIA – 1X AO DIA POR 5 DIAS | MÁX 10 ML/DIA",
            mgPerKgPerDay: 10,
            dosesPerDay: 1,
            concMgPerMl: 40,
            maxMlPerDay: 10
          }
        ],
        notes: "DOSE 10 MG/KG/DIA POR 5 DIAS. DOSE MÁXIMA 10 ML/DIA."
      },

      SMZ_TMP_40_8: {
        id: "SMZ_TMP_40_8",
        name: "SULFAMETOXAZOL + TRIMETOPRIMA 40 + 8 MG/ML",
        category: "ANTIBIÓTICOS",
        calculator: "SMZTMP",
        regimens: [
          {
            id: "TMP_8",
            label: "8 MG (TMP)/KG/DIA – 12/12 H",
            mgPerKgPerDay: 8,
            dosesPerDay: 2,
            concTmpMgPerMl: 8,
            maxMlPerDose: 20
          },
          {
            id: "TMP_12",
            label: "12 MG (TMP)/KG/DIA – 12/12 H",
            mgPerKgPerDay: 12,
            dosesPerDay: 2,
            concTmpMgPerMl: 8,
            maxMlPerDose: 20
          }
        ],
        notes: "DOSE USUAL 8 A 12 MG (TRIMETOPRIMA)/KG/DIA, VO, A CADA 12 HORAS. DOSE MÁXIMA 20 ML/DOSE."
      },

      CEFALEXINA_50: {
        id: "CEFALEXINA_50",
        name: "CEFALEXINA 50 MG/ML",
        category: "ANTIBIÓTICOS",
        calculator: "STANDARD",
        regimens: [
          {
            id: "CEFA_50",
            label: "DOSE PADRÃO 50 MG/KG/DIA – 6/6 H POR 7 DIAS | MÁX 10 ML/DOSE OU 2 G/DIA",
            mgPerKgPerDay: 50,
            dosesPerDay: 4,
            concMgPerMl: 50,
            maxMlPerDose: 10,
            maxTotalMgPerDay: 2000
          },
          {
            id: "CEFA_100",
            label: "DOSE ALTA 100 MG/KG/DIA – 6/6 H POR 7 DIAS | MÁX 10 ML/DOSE OU 2 G/DIA",
            mgPerKgPerDay: 100,
            dosesPerDay: 4,
            concMgPerMl: 50,
            maxMlPerDose: 10,
            maxTotalMgPerDay: 2000
          }
        ],
        notes: "DOSE PADRÃO 50 MG/KG/DIA E DOSE ALTA 100 MG/KG/DIA, EM 4 TOMADAS (6/6 H) POR 7 DIAS. MÁX 10 ML/DOSE OU 2 G/DIA."
      },

      NITROFURANTOINA_25_5: {
        id: "NITROFURANTOINA_25_5",
        name: "NITROFURANTOINA 25 MG/5 ML (5 MG/ML)",
        category: "ANTIBIÓTICOS",
        calculator: "STANDARD",
        regimens: [
          {
            id: "NITRO_5",
            label: "5 MG/KG/DIA – 6/6 H | MÁX 400 MG/DIA",
            mgPerKgPerDay: 5,
            dosesPerDay: 4,
            concMgPerMl: 5,
            maxTotalMgPerDay: 400
          },
          {
            id: "NITRO_7",
            label: "7 MG/KG/DIA – 6/6 H | MÁX 400 MG/DIA",
            mgPerKgPerDay: 7,
            dosesPerDay: 4,
            concMgPerMl: 5,
            maxTotalMgPerDay: 400
          }
        ],
        notes: "DOSE 5 A 7 MG/KG/DIA, EM 4 TOMADAS (6/6 H). DOSE MÁXIMA 400 MG/DIA."
      },

      KLARICID_25: {
        id: "KLARICID_25",
        name: "CLARITROMICINA (KLARICID) 25 MG/ML",
        category: "ANTIBIÓTICOS",
        calculator: "STANDARD",
        regimens: [
          {
            id: "KLAR_15",
            label: "15 MG/KG/DIA – 12/12 H | MÁX 10 ML/DOSE",
            mgPerKgPerDay: 15,
            dosesPerDay: 2,
            concMgPerMl: 25,
            maxMlPerDose: 10
          }
        ],
        notes: "DOSE 15 MG/KG/DIA EM 2 TOMADAS (12/12 H). DURAÇÃO HABITUAL 10 DIAS."
      },

      CIPRO_500: {
        id: "CIPRO_500",
        name: "CIPROFLOXACINO 500 MG COMPRIMIDO",
        category: "ANTIBIÓTICOS",
        calculator: "CIPRO",
        regimens: [
          {
            id: "CIPRO_10",
            label: "10 MG/KG/DOSE – 12/12 H | MÁX 750 MG/DOSE",
            mgPerKgPerDose: 10,
            dosesPerDay: 2,
            maxMgPerDose: 750
          },
          {
            id: "CIPRO_20",
            label: "20 MG/KG/DOSE – 12/12 H | MÁX 750 MG/DOSE",
            mgPerKgPerDose: 20,
            dosesPerDay: 2,
            maxMgPerDose: 750
          }
        ],
        notes: "AJUSTAR DURAÇÃO: 3–7 DIAS (CISTITE) OU 7–14 DIAS (PIELONEFRITE)."
      },

      CEFTRIAXONA_500: {
        id: "CEFTRIAXONA_500",
        name: "CEFTRIAXONA INJETÁVEL 500 MG",
        category: "ANTIBIÓTICOS",
        calculator: "CEFTRIAXONA",
        regimens: [
          {
            id: "CEFTRIAX_50",
            label: "50 MG/KG/DOSE – 1X AO DIA POR 1–3 DIAS",
            mgPerKgPerDose: 50,
            dosesPerDay: 1
          }
        ],
        notes: "DOSE 50 MG/KG/DOSE 1X AO DIA POR 1–3 DIAS. VOLUME EM ML CONFORME DILUIÇÃO DO SERVIÇO."
      },

      METOCLOPRAMIDA_GOTAS: {
        id: "METOCLOPRAMIDA_GOTAS",
        name: "METOCLOPRAMIDA GOTAS 4 MG/ML",
        category: "SINTOMÁTICOS",
        calculator: "METO_GOTAS",
        regimens: [
          {
            id: "METO_0_5",
            label: "0,5 GOTA/KG/DOSE | MÁX 52 GOTAS/DOSE",
            gotasPerKg: 0.5,
            maxGotasPerDose: 52
          },
          {
            id: "METO_1",
            label: "1 GOTA/KG/DOSE | MÁX 52 GOTAS/DOSE",
            gotasPerKg: 1.0,
            maxGotasPerDose: 52
          }
        ],
        notes: "DOSE 0,5 A 1 GOTA/KG/DOSE. DOSE MÁXIMA 52 GOTAS POR VEZ."
      },

      DIMENIDRINATO_GOTAS: {
        id: "DIMENIDRINATO_GOTAS",
        name: "DIMENIDRINATO GOTAS 25 MG/ML",
        category: "SINTOMÁTICOS",
        calculator: "DIMENIDRINATO",
        notes: "1 GOTA/KG/DOSE A CADA 6 H. DOSE MÁXIMA 40 GOTAS/DOSE."
      },

      LORATADINA: {
        id: "LORATADINA",
        name: "LORATADINA XAROPE 1 MG/ML",
        category: "ANTIALÉRGICOS",
        calculator: "LORATADINA",
        notes: "2 A 6 ANOS OU <30 KG: 5 ML 1X/DIA. ≥6 ANOS OU ≥30 KG: 10 ML 1X/DIA. EVITAR EM <2 ANOS."
      },

      DESLORATADINA: {
        id: "DESLORATADINA",
        name: "DESLORATADINA XAROPE 0,5 MG/ML",
        category: "ANTIALÉRGICOS",
        calculator: "DESLORATADINA",
        notes: "6–12 MESES: 2 ML 1X/DIA. 1–5 ANOS: 2,5 ML 1X/DIA. 6–12 ANOS: 5 ML 1X/DIA. ≥12 ANOS: 5 MG 1X/DIA."
      },

      HIDROXIZINA: {
        id: "HIDROXIZINA",
        name: "HIDROXIZINA XAROPE 2 MG/ML",
        category: "ANTIALÉRGICOS",
        calculator: "HIDROXIZINA",
        notes: "≥6 MESES E >6 KG. 8–10 KG: 2–2,5 ML; 10–12 KG: 2,5–3 ML; 12–24 KG: 3–6 ML; 24–40 KG: 6–12 ML, DE 6/6 H A 12/12 H. ≥12 ANOS: 25–100 MG 3–4X/DIA."
      },

      ACETILCISTEINA_20: {
        id: "ACETILCISTEINA_20",
        name: "ACETILCISTEÍNA XAROPE 20 MG/ML",
        category: "RESPIRATÓRIOS",
        calculator: "ACETILCISTEINA",
        notes: "2 A 4 ANOS: 5 ML (100 MG) 2–3X/DIA. ACIMA DE 4 ANOS: 5 ML (100 MG) 3–4X/DIA."
      },

      PREDNISOLONA_3: {
        id: "PREDNISOLONA_3",
        name: "PREDNISOLONA SOLUÇÃO 3 MG/ML",
        category: "CORTICOIDES",
        calculator: "PREDNISOLONA",
        regimens: [
          {
            id: "PRED_1",
            label: "1 MG/KG/DIA | MÁX 20 ML/DIA",
            mgPerKgPerDay: 1,
            dosesPerDay: 1,
            concMgPerMl: 3,
            maxMlPerDay: 20
          },
          {
            id: "PRED_2",
            label: "2 MG/KG/DIA | MÁX 20 ML/DIA",
            mgPerKgPerDay: 2,
            dosesPerDay: 1,
            concMgPerMl: 3,
            maxMlPerDay: 20
          }
        ],
        notes: "DOSE 1 A 2 MG/KG/DIA. DOSE MÁXIMA 20 ML/DIA."
      },

      DIAZEPAM_5_INJ: {
        id: "DIAZEPAM_5_INJ",
        name: "DIAZEPAM INJETÁVEL 5 MG/ML",
        category: "URGÊNCIAS",
        calculator: "DIAZEPAM",
        regimens: [
          {
            id: "DZP_0_5",
            label: "0,5 MG/KG/DOSE | MÁX 4 ML/DOSE",
            mgPerKgPerDose: 0.5,
            concMgPerMl: 5,
            maxMlPerDose: 4
          }
        ],
        notes: "0,5 MG/KG/DOSE, MÁX 4 ML POR VEZ. SE VIA IV, APLICAR LENTAMENTE. NÃO NECESSITA DILUIÇÃO."
      },

      ANNITA: {
        id: "ANNITA",
        name: "NITAZOXANIDA (ANNITA) 20 MG/ML",
        category: "ANTIPARASITÁRIOS",
        calculator: "ANNITA",
        notes: "FÓRMULA PRÁTICA: 7,5 × PESO ÷ 20 = ML/DOSE. 12/12 H POR 3 DIAS. MÁXIMO 15 ML/DOSE."
      },

      ALBENDAZOL: {
        id: "ALBENDAZOL",
        name: "ALBENDAZOL SUSPENSÃO 400 MG/10 ML",
        category: "ANTIPARASITÁRIOS",
        calculator: "ALBENDAZOL",
        notes: "DOSE HABITUAL 10 ML 1X/DIA POR 3–5 DIAS. EVITAR EM <2 ANOS, SALVO INDICAÇÃO ESPECÍFICA."
      },

      SIMETICONA_75: {
        id: "SIMETICONA_75",
        name: "SIMETICONA 75 MG/ML (GOTAS)",
        category: "SINTOMÁTICOS",
        calculator: "SIMETICONA",
        notes: "LACTENTES E <6 ANOS: 5–10 GOTAS 3–4X/DIA. ≥6 ANOS: 10–20 GOTAS 8/8 H."
      },

      DIPIRONA_500: {
        id: "DIPIRONA_500",
        name: "DIPIRONA GOTAS 500 MG/ML",
        category: "SINTOMÁTICOS",
        calculator: "DIPIRONA",
        notes: "0,6 GOTA/KG/DOSE A CADA 6 H, SE DOR OU FEBRE (≈15 MG/KG/DOSE)."
      },

      ONDANSETRONA_4_5: {
        id: "ONDANSETRONA_4_5",
        name: "ONDANSETRONA SOLUÇÃO 4 MG/5 ML",
        category: "SINTOMÁTICOS",
        calculator: "ONDANSETRONA",
        notes: "0,2 MG/KG/DOSE, MÁX 8 MG/DOSE, A CADA 8 H, POR CURTO PERÍODO."
      },

      DENGUE_HIDRATACAO: {
        id: "DENGUE_HIDRATACAO",
        name: "DENGUE – HIDRATAÇÃO ORAL 80 ML/KG/DIA",
        category: "HIDRATAÇÃO",
        calculator: "DENGUE",
        notes: "80 ML/KG/DIA. 1/3 EM SRO E 2/3 EM OUTROS LÍQUIDOS CLAROS."
      },

      ELOTIN: {
        id: "ELOTIN",
        name: "ELOTIN OTOLÓGICO",
        category: "OUTROS",
        calculator: "TEXTO_FIXO",
        notes: "3 GOTAS NO OUVIDO AFETADO 3X/DIA (8/8 H) POR 7 DIAS. ≥1 ANO."
      },

      LACTULOSE: {
        id: "LACTULOSE",
        name: "LACTULOSE 667 MG/ML XAROPE",
        category: "CONSTIPAÇÃO",
        calculator: "LACTULOSE",
        notes: "LACTENTES: 5 ML 12/12 H. 1–5 ANOS: 5–10 ML 12/12 H. 6–12 ANOS: 10–15 ML 12/12 H. >12 ANOS: 15–30 ML 12/12 H. ≈ PESO/4 ML/DOSE."
      },

      OLEO_MINERAL: {
        id: "OLEO_MINERAL",
        name: "ÓLEO MINERAL ORAL",
        category: "CONSTIPAÇÃO",
        calculator: "OLEO_MINERAL",
        notes: "1–5 ANOS: 5 ML 12/12 H. 5–10 ANOS: 7,5 ML 12/12 H. >10 ANOS: 15 ML 12/12 H."
      },

      MINILAX: {
        id: "MINILAX",
        name: "MINILAX SUPOSITÓRIO INFANTIL",
        category: "CONSTIPAÇÃO",
        calculator: "TEXTO_FIXO",
        notes: "APLICAR POR VIA RETAL TODO O CONTEÚDO DA BISNAGA."
      },

      PEG_3350: {
        id: "PEG_3350",
        name: "POLIETILENOGLICOL 3350 (SACHÊ PEDIÁTRICO)",
        category: "CONSTIPAÇÃO",
        calculator: "PEG",
        notes: "DOSE 1 G/KG/DIA. ESQUEMA USUAL: 1 SACHÊ 1X/DIA (AJUSTAR PELA GRAMAGEM)."
      }
    };

    function round(value, decimals) {
      const factor = Math.pow(10, decimals);
      return Math.round(value * factor) / factor;
    }

    function buildMedSelect() {
      const select = document.getElementById("medication");
      const categories = {};
      Object.values(MEDS_CONFIG).forEach((med) => {
        if (!categories[med.category]) categories[med.category] = [];
        categories[med.category].push(med);
      });
      select.innerHTML = "";
      Object.keys(categories).forEach((cat) => {
        const optgroup = document.createElement("optgroup");
        optgroup.label = cat;
        categories[cat].forEach((med) => {
          const opt = document.createElement("option");
          opt.value = med.id;
          opt.textContent = med.name;
          optgroup.appendChild(opt);
        });
        select.appendChild(optgroup);
      });
    }

    function updateRegimenSelect() {
      const medId = document.getElementById("medication").value;
      const med = MEDS_CONFIG[medId];
      const group = document.getElementById("regimen-group");
      const regimenSelect = document.getElementById("regimen");
      if (med && Array.isArray(med.regimens) && med.regimens.length > 0) {
        group.style.display = "block";
        regimenSelect.innerHTML = "";
        med.regimens.forEach((reg) => {
          const opt = document.createElement("option");
          opt.value = reg.id;
          opt.textContent = reg.label;
          regimenSelect.appendChild(opt);
        });
      } else {
        group.style.display = "none";
        regimenSelect.innerHTML = "";
      }
    }

    function getAgeInYearsAndMonths() {
      const ageValue = parseFloat(document.getElementById("ageValue").value);
      const ageUnit = document.getElementById("ageUnit").value;
      if (isNaN(ageValue) || ageValue < 0) return { years: null, months: null };
      if (ageUnit === "years") return { years: ageValue, months: ageValue * 12 };
      return { years: ageValue / 12, months: ageValue };
    }

    function calcStandard(weight, regimen, medConfig) {
      if (!regimen) return { error: "SELECIONE O ESQUEMA POSOLÓGICO.", medConfig };
      const totalMg = regimen.mgPerKgPerDay * weight;
      const doses = regimen.dosesPerDay;
      const mgPerDose = totalMg / doses;
      let mlPerDose = null, totalMlDay = null;
      const info = [], warnings = [];
      if (regimen.concMgPerMl) {
        mlPerDose = mgPerDose / regimen.concMgPerMl;
        totalMlDay = mlPerDose * doses;
      }
      info.push(
        `DOSE TOTAL DIÁRIA: <strong>${round(totalMg, 1)} MG</strong> (${round(regimen.mgPerKgPerDay, 1)} MG/KG/DIA), EM <strong>${doses} DOSES</strong>.`
      );
      if (mlPerDose !== null) {
        info.push(
          `POR DOSE: <strong>${round(mlPerDose, 1)} ML</strong> (${round(mgPerDose, 1)} MG), ${doses}X/DIA.`
        );
        info.push(
          `VOLUME DIÁRIO: <strong>${round(totalMlDay, 1)} ML/DIA</strong>.`
        );
      } else {
        info.push(
          `POR DOSE: <strong>${round(mgPerDose, 2)} MG</strong>, ${doses}X/DIA.`
        );
      }

      if (regimen.maxTotalMgPerDay && totalMg > regimen.maxTotalMgPerDay) {
        warnings.push(
          `DOSE CALCULADA ACIMA DO LIMITE DE <strong>${regimen.maxTotalMgPerDay} MG/DIA</strong>.`
        );
      }
      if (regimen.maxMlPerDose && mlPerDose !== null && mlPerDose > regimen.maxMlPerDose) {
        warnings.push(
          `VOLUME POR DOSE ACIMA DE <strong>${regimen.maxMlPerDose} ML/DOSE</strong>.`
        );
      }
      if (regimen.maxMlPerDay && totalMlDay !== null && totalMlDay > regimen.maxMlPerDay) {
        warnings.push(
          `VOLUME DIÁRIO ACIMA DE <strong>${regimen.maxMlPerDay} ML/DIA</strong>.`
        );
      }

      return { summary: info.join("<br>"), warnings, medConfig };
    }

    function calcAmoxClav(weight, regimen) {
      const medConfig = MEDS_CONFIG["AMOXCLAV_50_12_5"];
      const base = calcStandard(weight, regimen, medConfig);
      if (base.error) return base;

      const totalAmoxMgDay = regimen.mgPerKgPerDay * weight;
      const totalMlDay = totalAmoxMgDay / regimen.concMgPerMl;
      const clavPerMl = regimen.clavPerMl || 12.5;
      const totalClavDay = totalMlDay * clavPerMl;

      base.summary += `<br><br><strong>CLAVULANATO ESTIMADO:</strong> ${round(totalClavDay, 1)} MG/DIA.`;

      if (regimen.maxTotalAmoxMgPerDay && totalAmoxMgDay > regimen.maxTotalAmoxMgPerDay) {
        base.warnings.push(
          `AMOXICILINA ACIMA DE <strong>${regimen.maxTotalAmoxMgPerDay} MG/DIA</strong>.`
        );
      }
      if (regimen.maxTotalClavMgPerDay && totalClavDay > regimen.maxTotalClavMgPerDay) {
        base.warnings.push(
          `CLAVULANATO ACIMA DE <strong>${regimen.maxTotalClavMgPerDay} MG/DIA</strong>.`
        );
      }

      return base;
    }

    function calcSmzTmp(weight, regimen) {
      const medConfig = MEDS_CONFIG["SMZ_TMP_40_8"];
      if (!regimen) return { error: "SELECIONE O ESQUEMA (8 OU 12 MG (TMP)/KG/DIA).", medConfig };

      const totalTmpMgDay = regimen.mgPerKgPerDay * weight;
      const doses = regimen.dosesPerDay;
      const tmpMgPerDose = totalTmpMgDay / doses;
      const mlPerDose = tmpMgPerDose / regimen.concTmpMgPerMl;
      const smzMgPerMl = 40;
      const smzMgDose = mlPerDose * smzMgPerMl;

      const warnings = [];
      const info = [];

      info.push(
        `TRIMETOPRIMA: <strong>${round(tmpMgPerDose, 1)} MG/DOSE</strong> (${round(regimen.mgPerKgPerDay, 1)} MG/KG/DIA ÷ ${doses} DOSES).`
      );
      info.push(
        `APROXIMADAMENTE <strong>${round(mlPerDose, 2)} ML/DOSE</strong> (${round(smzMgDose, 1)} MG DE SULFAMETOXAZOL/DOSE).`
      );

      if (regimen.maxMlPerDose && mlPerDose > regimen.maxMlPerDose) {
        warnings.push(
          `VOLUME POR DOSE ACIMA DE <strong>${regimen.maxMlPerDose} ML/DOSE</strong>.`
        );
      }

      return {
        summary: info.join("<br>"),
        warnings,
        medConfig
      };
    }

    function calcMetoGotas(weight, regimen) {
      const medConfig = MEDS_CONFIG["METOCLOPRAMIDA_GOTAS"];
      if (!regimen) return { error: "SELECIONE 0,5 OU 1 GOTA/KG/DOSE.", medConfig };
      const gotasCalc = weight * regimen.gotasPerKg;
      const gotasMax = regimen.maxGotasPerDose || 52;
      let gotasDose = gotasCalc;
      const warnings = [];
      if (gotasDose > gotasMax) {
        warnings.push(
          `DOSE CALCULADA ACIMA DE ${gotasMax} GOTAS/DOSE. CONSIDERADO LIMITE DE ${gotasMax} GOTAS.`
        );
        gotasDose = gotasMax;
      }
      const mgPorGota = 4 / 20;
      const mgDose = gotasDose * mgPorGota;
      const mgKgDose = mgDose / weight;
      const mlDose = gotasDose / 20;

      const summary = `POSOLOGIA: <strong>${round(gotasDose, 0)} GOTAS</strong> (≈ ${round(mlDose, 2)} ML ≈ ${round(mgDose, 2)} MG ≈ ${round(mgKgDose, 2)} MG/KG/DOSE).`;

      warnings.push("MONITORAR EFEITOS EXTRAPIRAMIDAIS, ESPECIALMENTE EM CRIANÇAS PEQUENAS.");
      return { summary, warnings, medConfig };
    }

    function calcDimenidrinato(weight) {
      const medConfig = MEDS_CONFIG["DIMENIDRINATO_GOTAS"];
      const gotas = Math.min(Math.round(weight), 40);
      const warnings = [];
      if (weight > 40 && gotas === 40) {
        warnings.push("PESO ALTO PARA 1 GOTA/KG. MANTIDA DOSE MÁXIMA DE 40 GOTAS/DOSE.");
      }
      const summary = `POSOLOGIA: <strong>${gotas} GOTAS</strong> VO A CADA 6 H (MÁXIMO 40 GOTAS/DOSE).`;
      return { summary, warnings, medConfig };
    }

    function calcLoratadina(weight, ageYears) {
      const medConfig = MEDS_CONFIG["LORATADINA"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA LORATADINA.", medConfig };
      if (ageYears < 2) {
        warnings.push("EVITAR LORATADINA EM CRIANÇAS <2 ANOS.");
        return { summary: "EVITAR USO ROTINEIRO EM <2 ANOS.", warnings, medConfig };
      }
      let mlDose;
      if ((ageYears >= 2 && ageYears < 6) || weight < 30) mlDose = 5;
      else mlDose = 10;
      const summary = `POSOLOGIA: <strong>${mlDose} ML VO 1X/DIA</strong>.`;
      return { summary, warnings, medConfig };
    }

    function calcDesloratadina(ageYears, ageMonths) {
      const medConfig = MEDS_CONFIG["DESLORATADINA"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA DESLORATADINA.", medConfig };
      let mlDose, msg;
      if (ageMonths < 6) {
        warnings.push("EVITAR DESLORATADINA EM <6 MESES.");
        msg = "EVITAR USO EM <6 MESES.";
      } else if (ageMonths >= 6 && ageMonths < 12) {
        mlDose = 2;
        msg = `6–12 MESES: <strong>${mlDose} ML VO 1X/DIA</strong>.`;
      } else if (ageYears >= 1 && ageYears < 6) {
        mlDose = 2.5;
        msg = `1–5 ANOS: <strong>${mlDose} ML VO 1X/DIA</strong>.`;
      } else if (ageYears >= 6 && ageYears < 12) {
        mlDose = 5;
        msg = `6–12 ANOS: <strong>${mlDose} ML VO 1X/DIA</strong>.`;
      } else {
        msg = "≥12 ANOS: 5 MG VO 1X/DIA (COMPRIMIDO).";
      }
      return { summary: msg, warnings, medConfig };
    }

    function calcHidroxizina(weight, ageYears) {
      const medConfig = MEDS_CONFIG["HIDROXIZINA"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA HIDROXIZINA.", medConfig };
      let faixa;
      if (weight >= 8 && weight < 10) {
        faixa = "2 A 2,5 ML POR DOSE, DE 6/6 H A 12/12 H.";
      } else if (weight >= 10 && weight < 12) {
        faixa = "2,5 A 3 ML POR DOSE, DE 6/6 H A 12/12 H.";
      } else if (weight >= 12 && weight < 24) {
        faixa = "3 A 6 ML POR DOSE, DE 6/6 H A 12/12 H.";
      } else if (weight >= 24 && weight <= 40) {
        faixa = "6 A 12 ML POR DOSE, DE 6/6 H A 12/12 H.";
      } else if (ageYears >= 12) {
        faixa = "25 A 100 MG VO 3–4X/DIA.";
      } else {
        faixa = "PESO FORA DAS FAIXAS 8–40 KG. AJUSTAR COM CAUTELA.";
      }
      warnings.push("POTENCIAL DE SEDAÇÃO. EVITAR COM OUTROS DEPRESSORES DO SNC.");
      const summary = `POSOLOGIA EM FAIXA: <strong>${faixa}</strong>`;
      return { summary, warnings, medConfig };
    }

    function calcAnnita(weight) {
      const medConfig = MEDS_CONFIG["ANNITA"];
      const mlDose = (7.5 * weight) / 20;
      const mgDose = 7.5 * weight;
      const warnings = [];
      if (mlDose > 15) {
        warnings.push("DOSE CALCULADA >15 ML/DOSE. CONSIDERAR LIMITE DE 15 ML/DOSE.");
      }
      const summary = `POSOLOGIA: ≈ <strong>${round(mlDose, 1)} ML</strong> (${round(mgDose, 1)} MG) VO A CADA 12 H POR 3 DIAS (MÁX 15 ML/DOSE).`;
      return { summary, warnings, medConfig };
    }

    function calcAlbendazol(ageYears) {
      const medConfig = MEDS_CONFIG["ALBENDAZOL"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA ALBENDAZOL.", medConfig };
      if (ageYears < 2) {
        warnings.push("EVITAR ALBENDAZOL EM <2 ANOS, SALVO INDICAÇÃO ESPECÍFICA.");
      }
      const summary = "POSOLOGIA: <strong>10 ML VO 1X/DIA</strong> POR 3–5 DIAS.";
      return { summary, warnings, medConfig };
    }

    function calcSimeticona(ageYears) {
      const medConfig = MEDS_CONFIG["SIMETICONA_75"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA SIMETICONA.", medConfig };
      let faixa;
      if (ageYears < 6) {
        faixa = "5 A 10 GOTAS 3–4X/DIA APÓS MAMADAS/REFEIÇÕES.";
      } else {
        faixa = "10 A 20 GOTAS A CADA 8 H APÓS AS REFEIÇÕES E AO DORMIR.";
      }
      const summary = `POSOLOGIA: <strong>${faixa}</strong>`;
      return { summary, warnings, medConfig };
    }

    function calcDipirona(weight) {
      const medConfig = MEDS_CONFIG["DIPIRONA_500"];
      const warnings = [];
      const gotas = round(0.6 * weight, 0);
      const gotasAjust = gotas < 1 ? 1 : gotas;
      const mgPorGota = 500 / 20;
      const mgDose = gotasAjust * mgPorGota;
      const mgKgDose = mgDose / weight;
      const mlDose = gotasAjust / 20;
      const summary = `POSOLOGIA: <strong>${gotasAjust} GOTAS</strong> (≈ ${round(mgDose, 0)} MG ≈ ${round(mgKgDose, 1)} MG/KG/DOSE ≈ ${round(mlDose, 2)} ML) A CADA 6 H SE DOR OU FEBRE.`;
      if (mgKgDose > 20) {
        warnings.push("DOSE >20 MG/KG/DOSE. REVER PESO E INDICAÇÃO.");
      }
      return { summary, warnings, medConfig };
    }

    function calcOndansetrona(weight) {
      const medConfig = MEDS_CONFIG["ONDANSETRONA_4_5"];
      const warnings = [];
      const mgDoseCalc = 0.2 * weight;
      const maxMg = 8;
      let mgDose = mgDoseCalc;
      if (mgDoseCalc > maxMg) {
        warnings.push(`DOSE CALCULADA >${maxMg} MG. CONSIDERADO LIMITE DE ${maxMg} MG/DOSE.`);
        mgDose = maxMg;
      }
      const concMgPerMl = 4 / 5;
      const mlDose = mgDose / concMgPerMl;
      const summary = `POSOLOGIA: <strong>${round(mlDose, 1)} ML</strong> (${round(mgDose, 1)} MG) VO A CADA 8 H, POR CURTO PERÍODO.`;
      warnings.push("EVITAR USO PROLONGADO, ESPECIALMENTE EM CRIANÇAS PEQUENAS.");
      return { summary, warnings, medConfig };
    }

    function calcDengue(weight) {
      const medConfig = MEDS_CONFIG["DENGUE_HIDRATACAO"];
      const totalMl = 80 * weight;
      const totalL = totalMl / 1000;
      const sroMl = totalMl / 3;
      const sroL = sroMl / 1000;
      const outrosMl = totalMl - sroMl;
      const outrosL = outrosMl / 1000;
      const envelopes = Math.max(1, Math.ceil(sroL));
      const summary = `
        HIDRATAÇÃO TOTAL: <strong>${totalMl.toFixed(0)} ML/DIA</strong> (~${round(totalL, 2)} L/DIA).<br>
        SORO DE REIDRATAÇÃO ORAL: <strong>${sroMl.toFixed(0)} ML</strong> (~${round(sroL, 2)} L/DIA) ≈ ${envelopes} ENVELOPE(S).<br>
        OUTROS LÍQUIDOS CLAROS: <strong>${outrosMl.toFixed(0)} ML</strong> (~${round(outrosL, 2)} L/DIA).<br><br>
        DILUIR 1 ENVELOPE EM 1 L DE ÁGUA FILTRADA.
      `;
      return { summary, warnings: [], medConfig };
    }

    function calcCipro(weight, regimen) {
      const medConfig = MEDS_CONFIG["CIPRO_500"];
      if (!regimen) return { error: "SELECIONE 10 OU 20 MG/KG/DOSE.", medConfig };
      const warnings = [];
      const mgDoseCalc = regimen.mgPerKgPerDose * weight;
      const maxDose = regimen.maxMgPerDose;
      let mgDose = mgDoseCalc;
      if (mgDoseCalc > maxDose) {
        warnings.push(`DOSE >${maxDose} MG/DOSE. CONSIDERADO LIMITE DE ${maxDose} MG/DOSE.`);
        mgDose = maxDose;
      }
      const mgKg = mgDose / weight;
      const summary = `DOSE: <strong>${round(mgDose, 1)} MG/DOSE</strong> (${round(mgKg, 1)} MG/KG/DOSE) VO A CADA 12 H.`;
      return { summary, warnings, medConfig };
    }

    function calcCeftriaxona(weight, regimen) {
      const medConfig = MEDS_CONFIG["CEFTRIAXONA_500"];
      if (!regimen) return { error: "SELECIONE O ESQUEMA DE CEFTRIAXONA.", medConfig };
      const mgDose = regimen.mgPerKgPerDose * weight;
      const summary = `DOSE: <strong>${round(mgDose, 1)} MG</strong> (50 MG/KG/DOSE) 1X AO DIA POR 1–3 DIAS. AJUSTAR VOLUME CONFORME DILUIÇÃO.`;
      return { summary, warnings: [], medConfig };
    }

    function calcAcetilcisteina(ageYears) {
      const medConfig = MEDS_CONFIG["ACETILCISTEINA_20"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA ACETILCISTEÍNA.", medConfig };
      let summary;
      if (ageYears < 2) {
        warnings.push("ESQUEMA DESCRITO PARA ≥2 ANOS.");
        summary = "EVITAR USO ROTINEIRO EM <2 ANOS.";
      } else if (ageYears >= 2 && ageYears <= 4) {
        summary = "POSOLOGIA: 5 ML (100 MG) 2–3X/DIA.";
      } else {
        summary = "POSOLOGIA: 5 ML (100 MG) 3–4X/DIA.";
      }
      return { summary, warnings, medConfig };
    }

    function calcPrednisolona(weight, regimen) {
      const medConfig = MEDS_CONFIG["PREDNISOLONA_3"];
      if (!regimen) return { error: "SELECIONE 1 OU 2 MG/KG/DIA.", medConfig };
      const totalMg = regimen.mgPerKgPerDay * weight;
      const totalMl = totalMg / regimen.concMgPerMl;
      const warnings = [];
      if (regimen.maxMlPerDay && totalMl > regimen.maxMlPerDay) {
        warnings.push(`VOLUME DIÁRIO ACIMA DE ${regimen.maxMlPerDay} ML. AJUSTAR DOSE.`);
      }
      const summary = `DOSE DIÁRIA: <strong>${round(totalMg, 1)} MG</strong> (${round(totalMl, 1)} ML). ADMINISTRAR EM 1 OU 2 TOMADAS/DIA.`;
      return { summary, warnings, medConfig };
    }

    function calcDiazepam(weight, regimen) {
      const medConfig = MEDS_CONFIG["DIAZEPAM_5_INJ"];
      if (!regimen) return { error: "SELECIONE O ESQUEMA DE DIAZEPAM.", medConfig };
      const mgDose = regimen.mgPerKgPerDose * weight;
      const mlDose = mgDose / regimen.concMgPerMl;
      let mlFinal = mlDose;
      const warnings = [];
      if (mlDose > regimen.maxMlPerDose) {
        warnings.push(`VOLUME >${regimen.maxMlPerDose} ML. CONSIDERADO LIMITE DE ${regimen.maxMlPerDose} ML/DOSE.`);
        mlFinal = regimen.maxMlPerDose;
      }
      const mgFinal = mlFinal * regimen.concMgPerMl;
      const summary = `DOSE: <strong>${round(mlFinal, 2)} ML</strong> (${round(mgFinal, 1)} MG) POR DOSE (0,5 MG/KG). SE VIA IV, APLICAR LENTAMENTE.`;
      return { summary, warnings, medConfig };
    }

    function calcLactulose(weight, ageYears) {
      const medConfig = MEDS_CONFIG["LACTULOSE"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA LACTULOSE.", medConfig };
      const basePeso = weight ? weight / 4 : null;
      let faixa, doseTxt;
      if (ageYears < 1) {
        faixa = "LACTENTES: 5 ML 12/12 H.";
        doseTxt = basePeso ? ` DOSE APROXIMADA: ≈ ${round(basePeso, 1)} ML/DOSE.` : "";
      } else if (ageYears >= 1 && ageYears <= 5) {
        faixa = "1–5 ANOS: 5–10 ML 12/12 H.";
        doseTxt = basePeso ? ` SUGESTÃO: ≈ ${round(basePeso, 1)} ML ENTRE 5 E 10 ML.` : "";
      } else if (ageYears > 5 && ageYears <= 12) {
        faixa = "6–12 ANOS: 10–15 ML 12/12 H.";
        doseTxt = basePeso ? ` SUGESTÃO: ≈ ${round(basePeso, 1)} ML ENTRE 10 E 15 ML.` : "";
      } else {
        faixa = ">12 ANOS: 15–30 ML 12/12 H.";
        doseTxt = basePeso ? ` SUGESTÃO: ≈ ${round(basePeso, 1)} ML ENTRE 15 E 30 ML.` : "";
      }
      const summary = `${faixa}${doseTxt}`;
      return { summary, warnings, medConfig };
    }

    function calcOleoMineral(ageYears) {
      const medConfig = MEDS_CONFIG["OLEO_MINERAL"];
      const warnings = [];
      if (ageYears === null) return { error: "INFORME A IDADE PARA ÓLEO MINERAL.", medConfig };
      let summary;
      if (ageYears >= 1 && ageYears <= 5) {
        summary = "POSOLOGIA: 5 ML POR VIA ORAL A CADA 12 H.";
      } else if (ageYears > 5 && ageYears <= 10) {
        summary = "POSOLOGIA: 7,5 ML POR VIA ORAL A CADA 12 H.";
      } else {
        summary = "POSOLOGIA: 15 ML POR VIA ORAL A CADA 12 H.";
      }
      return { summary, warnings, medConfig };
    }

    function calcPeg(weight) {
      const medConfig = MEDS_CONFIG["PEG_3350"];
      const warnings = [];
      if (!weight || weight <= 0) return { error: "INFORME O PESO PARA PEG 3350.", medConfig };
      const gDia = weight * 1;
      const summary = `DOSE: ≈ <strong>${round(gDia, 1)} G/DIA</strong> (1 G/KG/DIA). ESQUEMA USUAL: 1 SACHÊ 1X/DIA (AJUSTAR PELA GRAMAGEM).`;
      return { summary, warnings, medConfig };
    }

    function renderResult(result, weight, ageYears, ageMonths, medId) {
      const container = document.getElementById("result-content");
      if (result.error) {
        container.innerHTML = `<div class="result-header"><span class="result-chip"><strong>ERRO:</strong> ${result.error}</span></div>`;
        return;
      }
      const med = MEDS_CONFIG[medId];
      const ageLabel =
        ageYears !== null
          ? `${round(ageYears, 2)} ANOS (${round(ageMonths, 0)} MESES)`
          : "NÃO INFORMADA";
      const warningHtml =
        result.warnings && result.warnings.length
          ? `<div class="result-section"><h4><span class="badge badge-warning">ATENÇÃO</span></h4><ul>${result.warnings
              .map((w) => `<li>${w}</li>`)
              .join("")}</ul></div>`
          : "";
      const notesHtml =
        med && med.notes
          ? `<div class="result-section"><h4><span class="badge badge-info">RESUMO</span></h4><p>${med.notes}</p></div>`
          : "";
      container.innerHTML = `
        <div class="result-header">
          <span class="result-chip"><strong>MEDICAMENTO:</strong> ${med ? med.name : ""}</span>
          <span class="result-chip"><strong>PESO:</strong> ${weight ? round(weight, 2) + " KG" : "NÃO INFORMADO"}</span>
          <span class="result-chip"><strong>IDADE:</strong> ${ageLabel}</span>
        </div>
        <div class="result-section">
          <h4>POSOLOGIA CALCULADA</h4>
          <p>${result.summary}</p>
        </div>
        ${warningHtml}
        ${notesHtml}
      `;
    }

    function handleCalculate() {
      const weight = parseFloat(document.getElementById("weight").value);
      const medId = document.getElementById("medication").value;
      const { years: ageYears, months: ageMonths } = getAgeInYearsAndMonths();
      const med = MEDS_CONFIG[medId];

      if (isNaN(weight) || weight <= 0) {
        renderResult(
          { error: "INFORME UM PESO VÁLIDO EM KG." },
          0,
          ageYears,
          ageMonths,
          medId
        );
        return;
      }

      let regimen = null;
      if (med && Array.isArray(med.regimens) && med.regimens.length > 0) {
        const regId = document.getElementById("regimen").value;
        regimen = med.regimens.find((r) => r.id === regId) || med.regimens[0];
      }

      let result;
      switch (medId) {
        case "AMOX_50":
          result = calcStandard(weight, regimen, med);
          break;
        case "AMOXCLAV_50_12_5":
          result = calcAmoxClav(weight, regimen);
          break;
        case "AZITRO_200_5":
          result = calcStandard(weight, regimen, med);
          break;
        case "SMZ_TMP_40_8":
          result = calcSmzTmp(weight, regimen);
          break;
        case "CEFALEXINA_50":
          result = calcStandard(weight, regimen, med);
          break;
        case "NITROFURANTOINA_25_5":
          result = calcStandard(weight, regimen, med);
          break;
        case "KLARICID_25":
          result = calcStandard(weight, regimen, med);
          break;
        case "CIPRO_500":
          result = calcCipro(weight, regimen);
          break;
        case "CEFTRIAXONA_500":
          result = calcCeftriaxona(weight, regimen);
          break;
        case "METOCLOPRAMIDA_GOTAS":
          result = calcMetoGotas(weight, regimen);
          break;
        case "DIMENIDRINATO_GOTAS":
          result = calcDimenidrinato(weight);
          break;
        case "LORATADINA":
          result = calcLoratadina(weight, ageYears);
          break;
        case "DESLORATADINA":
          result = calcDesloratadina(ageYears, ageMonths);
          break;
        case "HIDROXIZINA":
          result = calcHidroxizina(weight, ageYears);
          break;
        case "ACETILCISTEINA_20":
          result = calcAcetilcisteina(ageYears);
          break;
        case "PREDNISOLONA_3":
          result = calcPrednisolona(weight, regimen);
          break;
        case "DIAZEPAM_5_INJ":
          result = calcDiazepam(weight, regimen);
          break;
        case "ANNITA":
          result = calcAnnita(weight);
          break;
        case "ALBENDAZOL":
          result = calcAlbendazol(ageYears);
          break;
        case "SIMETICONA_75":
          result = calcSimeticona(ageYears);
          break;
        case "DIPIRONA_500":
          result = calcDipirona(weight);
          break;
        case "ONDANSETRONA_4_5":
          result = calcOndansetrona(weight);
          break;
        case "DENGUE_HIDRATACAO":
          result = calcDengue(weight);
          break;
        case "ELOTIN":
          result = { summary: med.notes, warnings: [], medConfig: med };
          break;
        case "LACTULOSE":
          result = calcLactulose(weight, ageYears);
          break;
        case "OLEO_MINERAL":
          result = calcOleoMineral(ageYears);
          break;
        case "MINILAX":
          result = { summary: med.notes, warnings: [], medConfig: med };
          break;
        case "PEG_3350":
          result = calcPeg(weight);
          break;
        default:
          result = { error: "MEDICAMENTO NÃO RECONHECIDO.", medConfig: med };
      }

      renderResult(result, weight, ageYears, ageMonths, medId);
    }

    document.addEventListener("DOMContentLoaded", () => {
      buildMedSelect();
      updateRegimenSelect();
      document.getElementById("medication").addEventListener("change", updateRegimenSelect);
      document.getElementById("calculateBtn").addEventListener("click", handleCalculate);
    });
  </script>
</body>
</html>
